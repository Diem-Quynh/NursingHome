{"version":3,"sources":["webpack:///./pages/admin/userPermissions/index.tsx","webpack:///./themes/services/api/UserPermissionService.ts","webpack:///./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?558a"],"names":["Index","permissions","total","useBaseHook","t","notify","redirect","setStore","getAuth","getStore","useState","hiddenDeleteBtn","setHiddenDeleteBtn","selectedIds","setSelectedIds","permissionService","UserPermissionService","confirmRef","React","createRef","tableRef","checkPermission","usePermissionHook","createPer","deletePer","renderCheckbox","row","permission","checked","avalibleValue","defaultChecked","disabled","columns","title","dataIndex","key","width","filterable","sorter","render","text","record","onClick","id","keyName","children","value","fetchData","values","a","to","index","error","code","message","onDelete","ids","current","reload","className","hidden","type","danger","show","ref","data","rowSelection","selectedRowKeys","onChange","length","onChangeSelection","onSubmit","content","getInitialProps","ctx","defaultOptions","filters","sorting","query","GridTableHelper","getOptions","namespacesRequired","getData","defaultQuery","makeQuery","UserPermission","context","name","url","this","route","href","Request","get","result","BaseApi","window","__NEXT_P","push"],"mappings":"mUAYMA,EAAQ,SAAC,GAAyE,IAAvEC,EAAuE,EAAvEA,YAAaC,EAA0D,EAA1DA,MAA0D,EACzBC,cAArDC,EAD8E,EAC9EA,EAAGC,EAD2E,EAC3EA,OAAQC,EADmE,EACnEA,SADmE,KACzDC,SADyD,EAC/CC,QAD+C,EACtCC,SACFC,oBAAS,IAAhDC,EAF+E,KAE9DC,EAF8D,OAGhDF,mBAAS,IAAxCG,EAH+E,KAGlEC,EAHkE,KAIhFC,EAAoB,IAAIC,IACxBC,EAAaC,IAAMC,YACnBC,EAAWF,IAAMC,YACfE,EAAoBC,cAApBD,gBACFE,EAAYF,EAAgB,CAChC,KAAQ,MAEJG,EAAYH,EAAgB,CAChC,KAAQ,MAGJI,EAAiB,SAACC,EAAUC,GAChC,IAAMC,GAAWF,EAAIG,cAAgBF,KAAgBA,EACrD,OAAO,EAAC,IAAD,CAAUG,eAAgBF,EAASG,UAAQ,KAG5CC,EAAU,CACd,CACEC,MAAO7B,EAAE,uBACT8B,UAAW,UACXC,IAAK,uBACLC,MAAO,MACPC,YAAY,EACZC,QAAQ,EACRC,OAAQ,SAACC,EAAcC,GAAf,OACR,OAAGC,QAAS,kBAAMpC,EAAS,sCAAuC,CAAEqC,GAAIF,EAAOE,OAAQF,EAAOG,WAEhG,CACEX,MAAO7B,EAAE,wBACT8B,UAAW,OACXC,IAAK,wBACLE,YAAY,GAEd,CACEJ,MAAO7B,EAAE,SACT8B,UAAW,YACXC,IAAK,mBACLG,QAAQ,EACRD,YAAY,GAEd,CACEJ,MAAO7B,EAAE,eACT8B,UAAW,cACXC,IAAK,eAEP,CACEF,MAAO7B,EAAE,iCACTyC,SAAU,CACR,CACEZ,MAAO7B,EAAE,UACT8B,UAAW,QACXC,IAAK,SACLC,MAAO,KACPG,OAAQ,SAACO,EAAYpB,GAAb,OAA0BD,EAAeC,EAAK,KAExD,CACEO,MAAO7B,EAAE,QACT8B,UAAW,QACXC,IAAK,SACLC,MAAO,KACPG,OAAQ,SAACO,EAAYpB,GAAb,OAA0BD,EAAeC,EAAK,KAExD,CACEO,MAAO7B,EAAE,QACT8B,UAAW,QACXC,IAAK,SACLC,MAAO,KACPG,OAAQ,SAACO,EAAYpB,GAAb,OAA0BD,EAAeC,EAAK,KAExD,CACEO,MAAO7B,EAAE,UACT8B,UAAW,QACXC,IAAK,SACLC,MAAO,KACPG,OAAQ,SAACO,EAAYpB,GAAb,OAA0BD,EAAeC,EAAK,QAiB1DqB,EAAS,uCAAG,WAAOC,GAAP,yBAAAC,EAAA,sEACwBC,YAAGnC,EAAkBoC,MAAMH,IADnD,sCACXI,EADW,KACJnD,EADI,MAEZmD,EAFY,wBAGNC,EAAkBD,EAAlBC,KAAMC,EAAYF,EAAZE,QACdjD,EAAOD,EAAE,UAAD,OAAWiD,IAASjD,EAAEkD,GAAU,SAJ1B,kBAKP,IALO,iCAOTrD,GAPS,4CAAH,sDAUTsD,EAAQ,uCAAG,gCAAAN,EAAA,sEACoBC,YAAGnC,EAAiB,OAAQ,CAAEyC,IAAK3C,KADvD,sCACVuC,EADU,WAEXA,EAFW,yCAGN/C,EAAOD,EAAE,UAAD,OAAWgD,EAAMC,OAASjD,EAAE,GAAD,OAAIgD,EAAME,UAAY,UAHnD,OAKfjD,EAAOD,EAAE,0BACgB,OAArBgB,EAASqC,SACXrC,EAASqC,QAAQC,SAEnB5C,EAAe,IACfF,GAAmB,GAVJ,4CAAH,qDAwBd,OAAO,EAAC,IAAD,KACL,SAAK+C,UAAU,UAAUhB,GAAG,cAC1B,EAAC,IAAD,CAAQiB,QAASrC,EAAWmB,QAAS,kBAAMpC,EAAS,0CAA0CuD,KAAK,UAAUF,UAAU,WACrH,EAAC,IAAD,MACCvD,EAAE,WAGL,EAAC,IAAD,CAAQ0D,QAAM,EAACpB,QAAS,WAAYzB,EAAWwC,SAASxC,EAAWwC,QAAQM,QAAUJ,UAAU,UAAUC,OAAQjD,IAAoBa,GACnI,EAAC,IAAD,MACCpB,EAAE,WAGL,EAAC,IAAD,CACE4D,IAAK5C,EACLY,QAASA,EACTiC,KAAMhE,EACNiE,aAAc,CAACC,gBAAiBtD,EAAauD,SAAU,SAACH,GAAD,OA5DnC,SAACA,GACrBA,EAAKI,OAAS,EAChBzD,GAAmB,GAGnBA,GAAmB,GAErBE,EAAemD,GAqD6DK,CAAkBL,KAC1FlB,UAAWA,EACX7C,MAAOA,IA3BT,EAAC,IAAD,CACE8D,IAAK/C,EACLsD,SAAUhB,EACVtB,MAAO7B,EAAE,cACToE,QAASpE,EAAE,8BA8BnBJ,EAAMyE,gBAAN,uCAAwB,WAAOC,GAAP,6BAAAzB,EAAA,6DAClBlC,EAAoB,IAAIC,IAAsB0D,GAC9CC,EAAiB,CACnBC,QAAS,GACTC,QAAS,IAEPC,EAAQJ,EAAII,MACZF,EAAUG,IAAgBC,WAAWF,EAAOH,GAP1B,SAQkBzB,YAAGnC,EAAkBoC,MAAMyB,IAR7C,0CAQjBxB,EARiB,KAQVnD,EARU,uBASf,CACLgF,mBAAoB,CAAC,SAAU,QAAS,OAAO,UAC/C7B,MAAOA,EACPnD,YAAaE,IAAY+E,QAAQjF,EAAa,OAAQ,IACtDC,MAAOC,IAAY+E,QAAQjF,EAAa,QAAS,GACjDkF,aAAc,CACZP,QAASG,IAAgBK,UAAUR,MAfjB,4CAAxB,sDAmBA5E,EAAMC,YAAc,CAClB,KAAQ,KAEKD,a,ykBCzLTqF,E,wCACJ,WAAYC,GAAkB,kCAC5B,cAAMA,IACDC,KAAO,kBAFgB,E,kGAIXtB,G,gFACXuB,EAAMC,KAAKC,MAAL,cAAkBD,KAAKF,KAAvB,iBAA4CtB,GAAM0B,K,SAC3CF,KAAKG,QAAQC,IAAIL,EAAKvB,G,cAArC6B,E,yBACGA,G,sHARkBC,GAYdV,O,sBCdVW,OAAOC,SAAWD,OAAOC,UAAY,IAAIC,KAAK,CAC7C,yBACA,WACE,OAAO,EAAQ,a","file":"static\\3bqcv_cRHHIBfHp_4lMA9\\pages\\admin\\userPermissions.js","sourcesContent":["import Layout from 'themes/layouts/Admin'\r\nimport { GridTable, GridTableHelper, FilterInput } from 'themes/components/Table';\r\nimport ConfirmDialog from 'themes/components/Dialogs/ConfirmDialog';\r\nimport { Button, Checkbox } from 'antd';\r\nimport UserPermissionService from 'themes/services/api/UserPermissionService';\r\nimport _ from 'lodash'\r\nimport to from 'await-to-js'\r\nimport React, { useState } from 'react';\r\nimport useBaseHook from 'themes/hooks/BaseHooks'\r\nimport usePermissionHook from \"themes/hooks/PermissionHook\";\r\nimport {PlusCircleOutlined, DeleteOutlined} from '@ant-design/icons';\r\n\r\nconst Index = ({ permissions, total }: { permissions: Permission[], total: number }) => {\r\n  const { t, notify, redirect, setStore, getAuth, getStore } = useBaseHook();\r\n  const [hiddenDeleteBtn, setHiddenDeleteBtn] = useState(true)\r\n  const [selectedIds, setSelectedIds] = useState([])\r\n  const permissionService = new UserPermissionService()\r\n  const confirmRef = React.createRef<ConfirmDialog>()\r\n  const tableRef = React.createRef<GridTable>()\r\n  const { checkPermission } = usePermissionHook();\r\n  const createPer = checkPermission({\r\n    \"root\": \"C\"\r\n  })\r\n  const deletePer = checkPermission({\r\n    \"root\": \"D\"\r\n  })\r\n\r\n  const renderCheckbox = (row: any, permission: number) => {\r\n    const checked = (row.avalibleValue & permission) === permission\r\n    return <Checkbox defaultChecked={checked} disabled ></Checkbox>\r\n  }\r\n\r\n    const columns = [\r\n      {\r\n        title: t('userPermissions.key'),\r\n        dataIndex: 'keyName',\r\n        key: 'user_permissions.key',\r\n        width: '18%',\r\n        filterable: true,\r\n        sorter: true,\r\n        render: (text: string, record: any) =>\r\n        <a onClick={() => redirect('frontend.admin.userPermissions.edit', { id: record.id })}>{record.keyName}</a>\r\n      },\r\n      {\r\n        title: t('userPermissions.name'),\r\n        dataIndex: 'name',\r\n        key: 'user_permissions.name',\r\n        filterable: true\r\n      },\r\n      {\r\n        title: t('group'),\r\n        dataIndex: 'groupName',\r\n        key: 'user_groups.name',\r\n        sorter: true,\r\n        filterable: true\r\n      },\r\n      {\r\n        title: t('description'),\r\n        dataIndex: 'description',\r\n        key: 'description',\r\n      },\r\n      {\r\n        title: t('userPermissions.avalibleValue'),\r\n        children: [\r\n          {\r\n            title: t(\"create\"),\r\n            dataIndex: 'value',\r\n            key: 'valueC',\r\n            width: '6%',\r\n            render: (value: any, row: any) => renderCheckbox(row, 8)\r\n          },\r\n          {\r\n            title: t(\"view\"),\r\n            dataIndex: 'value',\r\n            key: 'valueR',\r\n            width: '5%',\r\n            render: (value: any, row: any) => renderCheckbox(row, 4)\r\n          },\r\n          {\r\n            title: t(\"edit\"),\r\n            dataIndex: 'value',\r\n            key: 'valueU',\r\n            width: '5%',\r\n            render: (value: any, row: any) => renderCheckbox(row, 2)\r\n          },\r\n          {\r\n            title: t(\"delete\"),\r\n            dataIndex: 'value',\r\n            key: 'valueD',\r\n            width: '5%',\r\n            render: (value: any, row: any) => renderCheckbox(row, 1)\r\n          }\r\n        ]\r\n      },\r\n      \r\n    ];\r\n\r\n  const onChangeSelection = (data: any) => {\r\n    if (data.length > 0) {\r\n      setHiddenDeleteBtn(false)\r\n    }\r\n    else {\r\n      setHiddenDeleteBtn(true)\r\n    }\r\n    setSelectedIds(data)\r\n  }\r\n\r\n  const fetchData = async (values: any) => {\r\n    let [error, permissions]: any[] = await to(permissionService.index(values))\r\n    if (error) {\r\n      const { code, message } = error\r\n      notify(t(`errors:${code}`), t(message), 'error')\r\n      return {}\r\n    }\r\n    return permissions\r\n  }\r\n\r\n  const onDelete = async () => {\r\n    let [error, result]: any[] = await to(permissionService.delete({ ids: selectedIds }));\r\n    if (error) {\r\n      return notify(t(`errors:${error.code}`), t(`${error.message}`), 'error')\r\n    }\r\n    notify(t(\"message.recordDeleted\"));\r\n    if (tableRef.current !== null) {\r\n      tableRef.current.reload()\r\n    }\r\n    setSelectedIds([])\r\n    setHiddenDeleteBtn(true)\r\n  }\r\n\r\n  const renderDeleteDialog = () => {\r\n    return (\r\n      <ConfirmDialog\r\n        ref={confirmRef}\r\n        onSubmit={onDelete}\r\n        title={t('deleteItem')}\r\n        content={t('message.deleteConfirm')}\r\n      />\r\n    )\r\n  }\r\n\r\n  return <Layout>\r\n    <div className=\"content\" id=\"permission\">\r\n      <Button hidden={!createPer} onClick={() => redirect(\"frontend.admin.userPermissions.create\")} type=\"primary\" className='btn-top'>\r\n        <PlusCircleOutlined />\r\n        {t('create')}\r\n      </Button>\r\n\r\n      <Button danger onClick={() => { if (confirmRef.current) confirmRef.current.show() }} className='btn-top' hidden={hiddenDeleteBtn || !deletePer}>\r\n        <DeleteOutlined />\r\n        {t('delete')}\r\n      </Button>\r\n      \r\n      <GridTable\r\n        ref={tableRef}\r\n        columns={columns}\r\n        data={permissions}\r\n        rowSelection={{selectedRowKeys: selectedIds, onChange: (data: any[]) => onChangeSelection(data) }}\r\n        fetchData={fetchData}\r\n        total={total}\r\n      />\r\n      {renderDeleteDialog()}\r\n    </div>\r\n  </Layout>\r\n}\r\n\r\nIndex.getInitialProps = async (ctx: any) => {\r\n  let permissionService = new UserPermissionService(ctx)\r\n  let defaultOptions = {\r\n    filters: [],\r\n    sorting: []\r\n  }\r\n  let query = ctx.query\r\n  let filters = GridTableHelper.getOptions(query, defaultOptions);\r\n  let [error, permissions]: any[] = await to(permissionService.index(filters))\r\n  return {\r\n    namespacesRequired: ['common', 'pages', 'menu','errors'],\r\n    error: error,\r\n    permissions: useBaseHook.getData(permissions, \"data\", []),\r\n    total: useBaseHook.getData(permissions, \"total\", 0),\r\n    defaultQuery: {\r\n      filters: GridTableHelper.makeQuery(filters)\r\n    }\r\n  }\r\n}\r\nIndex.permissions = {\r\n  \"root\": \"R\"\r\n};\r\nexport default Index","import BaseApi from './BaseService'\r\nimport { group } from 'console';\r\n\r\nclass UserPermission extends BaseApi {\r\n  constructor(context?: Context){\r\n    super(context)\r\n    this.name = 'userPermissions'; //kế thừa CRUD từ thằng cha\r\n  }\r\n  async getByGroupId(data: {groupId: number}){\r\n    const url = this.route(`api.${this.name}.getByGroupId`, data).href\r\n    let result = await this.Request.get(url, data)\r\n    return result;\r\n  }\r\n}\r\n\r\nexport default UserPermission","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/admin/userPermissions\",\n      function () {\n        return require(\"private-next-pages/admin/userPermissions/index.tsx\");\n      }\n    ]);\n  "],"sourceRoot":""}