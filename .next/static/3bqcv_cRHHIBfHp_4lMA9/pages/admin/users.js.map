{"version":3,"sources":["webpack:///./node_modules/next/dist/build/webpack/loaders/next-client-pages-loader.js?5924","webpack:///./pages/admin/users/index.tsx"],"names":["window","__NEXT_P","push","Index","users","total","useBaseHook","t","notify","redirect","setStore","getAuth","getStore","useState","hiddenDeleteBtn","setHiddenDeleteBtn","selectedIds","setSelectedIds","userService","UserService","confirmRef","React","createRef","tableRef","checkPermission","usePermissionHook","createPer","deletePer","columns","title","dataIndex","key","filterable","width","render","text","record","onClick","id","code","fixed","sorter","filterDate","value","String","substr","filterCheck","options","label","Math","round","Number","formaterGender","fetchData","values","a","to","index","error","message","onDelete","ids","current","reload","className","hidden","type","danger","show","ref","data","rowSelection","selectedRowKeys","onChange","length","onChangeSelection","scroll","x","onSubmit","content","getInitialProps","ctx","defaultOptions","filters","sorting","query","GridTableHelper","getOptions","namespacesRequired","getData","defaultQuery","makeQuery","permissions"],"mappings":"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","file":"static\\3bqcv_cRHHIBfHp_4lMA9\\pages\\admin\\users.js","sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/admin/users\",\n      function () {\n        return require(\"private-next-pages/admin/users/index.tsx\");\n      }\n    ]);\n  ","import Layout from 'themes/layouts/Admin'\r\nimport { GridTable, GridTableHelper, FilterInput } from 'themes/components/Table';\r\nimport ConfirmDialog from 'themes/components/Dialogs/ConfirmDialog';\r\nimport { Button } from 'antd';\r\nimport UserService from 'themes/services/api/UserService';\r\nimport _ from 'lodash'\r\nimport to from 'await-to-js'\r\nimport React, { useState } from 'react';\r\nimport useBaseHook from 'themes/hooks/BaseHooks'\r\nimport usePermissionHook from \"themes/hooks/PermissionHook\";\r\nimport {PlusCircleOutlined, DeleteOutlined} from '@ant-design/icons';\r\n\r\nconst formaterGender = (value: any) => {\r\n  const { t } = useBaseHook();\r\n  value = Math.round(Number(value))\r\n  value = (value == 0 ? t('male') : t('female'))\r\n  return `${value}`\r\n}\r\n\r\nconst formaterDate = (value: any) => {\r\n  value = value? String(value) : \"\"\r\n  value = value.substr(0,10)\r\n  return `${value}`\r\n}\r\n\r\nconst Index = ({ users, total }: { users: User[], total: number }) => {\r\n  const { t, notify, redirect, setStore, getAuth, getStore } = useBaseHook();\r\n  const [hiddenDeleteBtn, setHiddenDeleteBtn] = useState(true)\r\n  const [selectedIds, setSelectedIds] = useState([])\r\n  const userService = new UserService()\r\n  const confirmRef = React.createRef<ConfirmDialog>()\r\n  const tableRef = React.createRef<GridTable>()\r\n  const { checkPermission } = usePermissionHook();\r\n  const createPer = checkPermission({\r\n    \"admin.users\": \"C\"\r\n  })\r\n  const deletePer = checkPermission({\r\n    \"admin.users\": \"D\"\r\n  })\r\n\r\n  const columns = [\r\n    {\r\n      title: t(\"code\"),\r\n      dataIndex: 'code',\r\n      key: 'code',\r\n      filterable: true,\r\n      width: '100px',\r\n      render: (text: string, record: any) =>\r\n        <a onClick={() => redirect('frontend.admin.users.edit', { id: record.id })}>{record.code}</a>,\r\n      \r\n      fixed: 'left',\r\n    },\r\n    {\r\n      title: t('name'),\r\n      dataIndex: 'fullname',\r\n      key: 'fullname',\r\n      filterable: true,\r\n      sorter: true,\r\n      fixed: 'left',\r\n    },\r\n    {\r\n      title: t('position'),\r\n      dataIndex: 'position',\r\n      key: 'position',\r\n      filterable: true,\r\n      width: '8%'\r\n    },\r\n    {\r\n      title: t(\"userGroup\"),\r\n      dataIndex: 'groupName',\r\n      key: 'user_groups.name',\r\n      filterable: true,\r\n    },\r\n    {\r\n      title: t(\"username\"),\r\n      dataIndex: 'username',\r\n      key: 'username',\r\n      filterable: true\r\n    },\r\n    {\r\n      title: t('birthday'),\r\n      dataIndex: 'birthday',\r\n      key: 'birthday',\r\n      filterDate: true,\r\n      width: '7%',\r\n      render: (text: string, record: any) => <div>{formaterDate(text)}</div>\r\n    },\r\n    {\r\n      title: t('gender'),\r\n      dataIndex: 'gender',\r\n      key: 'gender',\r\n      filterCheck: true,\r\n      options: [{ label:t('male'), value:0 }, { label:t('female'), value:1 }],\r\n      width: '6%',\r\n      render: (text: string, record: any) => <div>{formaterGender(text)}</div>\r\n    },\r\n    {\r\n      title: t('address'),\r\n      dataIndex: 'address',\r\n      key: 'address',\r\n    },\r\n    {\r\n      title: t('cardId'),\r\n      dataIndex: 'cardId',\r\n      key: 'cardId',\r\n      filterable: true\r\n    },\r\n    {\r\n      title: t(\"phone\"),\r\n      dataIndex: 'phone',\r\n      key: 'phone',\r\n      filterable: true,\r\n    },\r\n    {\r\n      title: t(\"email\"),\r\n      dataIndex: 'email',\r\n      key: 'email',\r\n      filterable: true,\r\n    },\r\n  ]\r\n\r\n  const onChangeSelection = (data: any) => {\r\n    if (data.length > 0) {\r\n      setHiddenDeleteBtn(false)\r\n    }\r\n    else {\r\n      setHiddenDeleteBtn(true)\r\n    }\r\n    setSelectedIds(data)\r\n  }\r\n\r\n  const fetchData = async (values: any) => {\r\n    let [error, users]: any[] = await to(userService.index(values))\r\n    if (error) {\r\n      const { code, message } = error\r\n      notify(t(`errors:${code}`), t(message), 'error')\r\n      return {}\r\n    }\r\n    return users\r\n  }\r\n\r\n  const onDelete = async () => {\r\n    let [error, result]: any[] = await to(userService.delete({ ids: selectedIds }));\r\n    if (error) {\r\n      return notify(t(`errors:${error.code}`), t(`${error.message}`), 'error')\r\n    }\r\n    notify(t(\"message.recordDeleted\"));\r\n    if (tableRef.current !== null) {\r\n      tableRef.current.reload()\r\n    }\r\n    setSelectedIds([])\r\n    setHiddenDeleteBtn(true)\r\n  }\r\n\r\n  const renderDeleteDialog = () => {\r\n    return (\r\n      <ConfirmDialog\r\n        ref={confirmRef}\r\n        onSubmit={onDelete}\r\n        title={t('deleteItem')}\r\n        content={t('message.deleteConfirm')}\r\n      />\r\n    )\r\n  }\r\n\r\n  return <Layout>\r\n    <div className=\"content\">\r\n      <Button hidden={!createPer} onClick={() => redirect(\"frontend.admin.users.create\")} type=\"primary\" className='btn-top'>\r\n        <PlusCircleOutlined />\r\n        {t('create')}\r\n      </Button>\r\n\r\n      <Button danger onClick={() => { if (confirmRef.current) confirmRef.current.show() }} className='btn-top' hidden={hiddenDeleteBtn || !deletePer}>\r\n        <DeleteOutlined />\r\n        {t('delete')}\r\n      </Button>\r\n      \r\n      <GridTable\r\n        ref={tableRef}\r\n        columns={columns}\r\n        data={users}\r\n        rowSelection={{selectedRowKeys: selectedIds, onChange: (data: any[]) => onChangeSelection(data) }}\r\n        fetchData={fetchData}\r\n        total={total}\r\n        scroll={{ x: 1800 }}\r\n      />\r\n      {renderDeleteDialog()}\r\n    </div>\r\n  </Layout>\r\n}\r\n\r\nIndex.getInitialProps = async (ctx: any) => {\r\n  let userService = new UserService(ctx)\r\n  let defaultOptions = {\r\n    filters: [],\r\n    sorting: []\r\n  }\r\n  let query = ctx.query\r\n  let filters = GridTableHelper.getOptions(query, defaultOptions);\r\n  let [error, users]: any[] = await to(userService.index(filters))\r\n  return {\r\n    namespacesRequired: ['common', 'pages', 'menu', 'errors'],\r\n    error: error,\r\n    users: useBaseHook.getData(users, \"data\", []),\r\n    total: useBaseHook.getData(users, \"total\", 0),\r\n    defaultQuery: {\r\n      filters: GridTableHelper.makeQuery(filters)\r\n    }\r\n  }\r\n}\r\nIndex.permissions = {\r\n  \"admin.users\": \"R\"\r\n};\r\nexport default Index"],"sourceRoot":""}