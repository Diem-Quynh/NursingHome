{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport App, { Container } from 'next/app';\nimport { appWithTranslation } from 'themes/modules/I18n';\nimport { Provider } from 'react-redux';\nimport { makeStore, setStore } from 'themes/components/Store';\nimport nextCookie from 'next-cookies';\nimport withRedux from \"next-redux-wrapper\";\nimport Loading from 'themes/components/Loading';\nimport 'themes/less/custom-ant-theme.less';\nimport 'themes/less/home.less';\nimport 'themes/less/login.less';\nimport 'themes/less/admin.less';\nimport _ from 'lodash';\nimport Error403Page from 'themes/components/Errors/403';\nimport { ScrollToTopButton } from 'themes/components/Utils';\nimport { checkPermission, decToCrud } from 'themes/utils/Permission';\nimport getConfig from 'next/config';\nconst {\n  publicRuntimeConfig\n} = getConfig();\n\nclass MyApp extends App {\n  static async getInitialProps(AppContext) {\n    const {\n      Component,\n      ctx\n    } = AppContext; //check permission\n\n    const pagePermissions = Component.permissions;\n    const cookies = nextCookie(ctx);\n\n    const userPermissions = _.get(cookies, \"user.permissions\", {});\n\n    let resultPermission = {};\n    let newComponent = Component;\n\n    if (pagePermissions) {\n      resultPermission = checkPermission(pagePermissions, userPermissions, true);\n      if (resultPermission != true) newComponent = Error403Page;\n    }\n\n    const appProps = await App.getInitialProps(_objectSpread(_objectSpread({}, AppContext), {}, {\n      Component: newComponent\n    })); // calls page's `getInitialProps` and fills `appProps.pageProps`\n\n    ctx.store.dispatch(setStore(\"auth\", cookies.user));\n    ctx.store.dispatch(setStore(\"cookies\", cookies));\n    ctx.store.dispatch(setStore(\"publicRuntimeConfig\", publicRuntimeConfig));\n    let namespacesRequired = appProps.namespacesRequired || [];\n    return _objectSpread(_objectSpread(_objectSpread({}, resultPermission), appProps), {}, {\n      auth: cookies.user,\n      cookies: cookies,\n      namespacesRequired: [...namespacesRequired, 'common', 'pages', 'menu']\n    });\n  }\n\n  render() {\n    let {\n      Component,\n      pageProps,\n      store,\n      error,\n      permissions\n    } = this.props;\n    return __jsx(React.Fragment, null, __jsx(Loading, null), __jsx(Provider, {\n      store: store\n    }, error ? __jsx(Error403Page, {\n      permissions: permissions\n    }) : __jsx(Component, pageProps), __jsx(ScrollToTopButton, null)));\n  }\n\n}\n\nexport default withRedux(makeStore)(appWithTranslation(MyApp));","map":{"version":3,"sources":["E:/DATN/nursinghome/pages/_app.jsx"],"names":["React","App","Container","appWithTranslation","Provider","makeStore","setStore","nextCookie","withRedux","Loading","_","Error403Page","ScrollToTopButton","checkPermission","decToCrud","getConfig","publicRuntimeConfig","MyApp","getInitialProps","AppContext","Component","ctx","pagePermissions","permissions","cookies","userPermissions","get","resultPermission","newComponent","appProps","store","dispatch","user","namespacesRequired","auth","render","pageProps","error","props"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport App, { Container } from 'next/app';\r\nimport { appWithTranslation } from 'themes/modules/I18n'\r\nimport { Provider } from 'react-redux'\r\nimport { makeStore, setStore } from 'themes/components/Store'\r\nimport nextCookie from 'next-cookies'\r\nimport withRedux from \"next-redux-wrapper\";\r\nimport Loading from 'themes/components/Loading'\r\nimport 'themes/less/custom-ant-theme.less';\r\nimport 'themes/less/home.less'\r\nimport 'themes/less/login.less'\r\nimport 'themes/less/admin.less'\r\nimport _ from 'lodash'\r\n\r\nimport Error403Page from 'themes/components/Errors/403'\r\nimport { ScrollToTopButton } from 'themes/components/Utils'\r\nimport { checkPermission, decToCrud } from 'themes/utils/Permission'\r\nimport getConfig from 'next/config'\r\nconst { publicRuntimeConfig } = getConfig();\r\n\r\n\r\nclass MyApp extends App {\r\n\r\n  static async getInitialProps(AppContext) {\r\n    const { Component, ctx } = AppContext\r\n\r\n    //check permission\r\n    const pagePermissions = Component.permissions\r\n    const cookies = nextCookie(ctx)\r\n    const userPermissions = _.get(cookies, \"user.permissions\", {})\r\n    let resultPermission = {}\r\n    let newComponent = Component\r\n\r\n\r\n    if (pagePermissions) {\r\n      resultPermission = checkPermission(pagePermissions, userPermissions, true);\r\n      if (resultPermission != true) newComponent = Error403Page\r\n    }\r\n\r\n    const appProps = await App.getInitialProps({\r\n      ...AppContext,\r\n      Component: newComponent\r\n    });\r\n\r\n    // calls page's `getInitialProps` and fills `appProps.pageProps`\r\n    ctx.store.dispatch(setStore(\"auth\", cookies.user));\r\n    ctx.store.dispatch(setStore(\"cookies\", cookies));\r\n    ctx.store.dispatch(setStore(\"publicRuntimeConfig\", publicRuntimeConfig));\r\n    let namespacesRequired = appProps.namespacesRequired || []\r\n\r\n    return {\r\n      ...resultPermission,\r\n      ...appProps,\r\n      auth: cookies.user,\r\n      cookies: cookies,\r\n      namespacesRequired: [...namespacesRequired, 'common', 'pages', 'menu'],\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let { Component, pageProps, store, error, permissions } = this.props;\r\n    return (\r\n      <>\r\n        <Loading />\r\n        <Provider store={store}>\r\n          {error ?\r\n            <Error403Page permissions={permissions} />\r\n            :\r\n            <Component {...pageProps} />\r\n          }\r\n          <ScrollToTopButton />\r\n        </Provider>\r\n      </>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRedux(makeStore)(appWithTranslation(MyApp))"]},"metadata":{},"sourceType":"module"}