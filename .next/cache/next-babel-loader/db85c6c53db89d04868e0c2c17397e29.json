{"ast":null,"code":"var _jsxFileName = \"E:\\\\DATN\\\\nursinghome\\\\themes\\\\components\\\\Table\\\\Table.jsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { SearchOutlined } from '@ant-design/icons';\nimport { Table, Button, Input, Radio, Divider } from 'antd';\nimport { addQuery } from 'themes/route';\nimport { withRouter, useRouter } from 'next/router';\nimport Highlighter from \"react-highlight-words\";\nimport { Base64 } from 'js-base64';\nimport _ from 'lodash';\nimport FilterInput from './SearchComponents/Input';\nimport DatePicker from './SearchComponents/DatePicker';\n\nclass GridTable extends React.Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"defaultOptionToColumns\", defaultOptions => {\n      this.columns = this.columns.map(column => {\n        //set field\n        if (!column.field) column.field = column.key;\n        let sort = defaultOptions.sorting.find(item => item.field === column.field);\n\n        if (sort) {\n          let {\n            direction\n          } = sort;\n          column.sortOrder = direction === \"asc\" ? 'ascend' : 'descend';\n        }\n\n        let filters = defaultOptions.filters.filter(item => item.field === column.field);\n\n        if (filters.length) {\n          column.filteredValue = [...filters];\n        } else {\n          delete column.filteredValue;\n        }\n\n        if (column.filterable) {\n          //    delete column.filterable;\n          column = _objectSpread(_objectSpread({}, column), this.getColumnSearchProps(column));\n        }\n\n        return column;\n      });\n    });\n\n    _defineProperty(this, \"getColumnSearchProps\", column => {\n      let ref = React.createRef();\n      return {\n        filterDropdown: ({\n          confirm,\n          setSelectedKeys\n        }) => {\n          let confirmFnc = values => {\n            let currentColumn = this.columns.find(c => c.dataIndex === column.dataIndex);\n            setSelectedKeys(values);\n            confirm();\n            this.reload();\n          };\n\n          if (column.renderFilter) {\n            return column.renderFilter({\n              column,\n              confirm: confirmFnc,\n              ref\n            });\n          }\n\n          if (this.props.type == \"date\") return __jsx(DatePicker, {\n            column: column,\n            ref: ref,\n            confirm: confirmFnc,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123,\n              columnNumber: 24\n            }\n          });else return __jsx(FilterInput, {\n            column: column,\n            ref: ref,\n            confirm: confirmFnc,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 24\n            }\n          });\n        },\n        filterIcon: filtered => __jsx(SearchOutlined, {\n          style: {\n            color: filtered ? \"#1890ff\" : undefined\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 17\n          }\n        }),\n        onFilterDropdownVisibleChange: visible => {\n          if (!visible && column.visibleSearch != visible) {\n            column.visibleSearch = visible;\n\n            if (ref.current) {\n              ref.current.onSubmit();\n            }\n          }\n\n          column.visibleSearch = visible;\n        }\n      };\n    });\n\n    _defineProperty(this, \"clearAll\", async () => {\n      let {\n        pageSize,\n        page\n      } = this.pagination;\n      await this.handleTableChange({\n        pageSize,\n        current: page\n      }, {}, {});\n    });\n\n    _defineProperty(this, \"setFiltersToColumns\", (filters = {}) => {\n      this.columns = this.columns.map(column => {\n        let filter = filters[column.field];\n\n        if (filter) {\n          column.filteredValue = filter;\n        } else {\n          delete column.filteredValue;\n        }\n\n        return column;\n      });\n    });\n\n    _defineProperty(this, \"setSorterToColumns\", (sorter = {}) => {\n      this.columns = this.columns.map(column => {\n        if (column.key == sorter.columnKey) {\n          column.sortOrder = sorter.order;\n        } else {\n          delete column.sortOrder;\n        }\n\n        return column;\n      });\n    });\n\n    _defineProperty(this, \"setPagination\", pagination => {\n      this.pagination = {\n        pageSize: pagination.pageSize,\n        page: pagination.current - 1\n      };\n    });\n\n    _defineProperty(this, \"handleTableChange\", async (pagination, filters, sorter) => {\n      this.setFiltersToColumns(filters);\n      this.setSorterToColumns(sorter);\n      this.setPagination(pagination);\n      this.reload();\n    });\n\n    _defineProperty(this, \"buildFetchData\", () => {\n      let params = {\n        filters: [],\n        sorting: [],\n        pageSize: this.pagination.pageSize,\n        page: this.pagination.page\n      };\n      this.columns.map(column => {\n        if (column.filteredValue) {\n          params.filters = [...params.filters, ...column.filteredValue];\n        }\n\n        if (column.sortOrder) {\n          params.sorting.push({\n            field: column.field,\n            direction: column.sortOrder == \"ascend\" ? \"asc\" : \"desc\"\n          });\n        }\n      });\n      return params;\n    });\n\n    _defineProperty(this, \"getPagination\", (pagination = {}) => {\n      const {\n        pageSize,\n        page\n      } = this.pagination;\n      return _objectSpread(_objectSpread({}, pagination), {}, {\n        total: this.total,\n        position: 'bottom',\n        pageSize: pageSize || 50,\n        current: page + 1,\n        showSizeChanger: true,\n        pageSizeOptions: ['2', '10', '50', '100', '200', '500']\n      });\n    });\n\n    this.initialProps = {\n      bordered: true,\n      size: 'middle',\n      showHeader: true,\n      hasData: true\n    };\n    this.state = {\n      loading: false,\n      reload: false\n    };\n    this.pagination = {};\n    this.total = this.props.total || 100;\n    this.data = this.props.data;\n    this.handleTableChange = this.handleTableChange.bind(this);\n  }\n  /**\r\n   * Khởi tạo các options từ query trên url\r\n   */\n\n\n  init() {\n    const query = this.props.router.query;\n    const defaultOptions = GridTable.getDataFromQuery(query, this.props);\n    this.pagination = {\n      pageSize: defaultOptions.pageSize || 50,\n      page: defaultOptions.page || 0\n    };\n    this.columns = this.props.columns;\n    this.defaultOptionToColumns(defaultOptions);\n  }\n  /**\r\n   * Convert lại dữ liệu từ query đổi sang đúng format của column trong antd\r\n   */\n\n\n  componentDidMount() {\n    this.init();\n    this.setState({\n      reload: !this.state.reload\n    });\n  }\n\n  componentDidUpdate(prevProps) {\n    //update data trong trường hợp đổi từ props bên ngoài\n    if (JSON.stringify(prevProps.data) !== JSON.stringify(this.props.data)) {\n      this.data = this.props.data;\n    }\n\n    if (JSON.stringify(this.props.router.query) != JSON.stringify(prevProps.router.query)) {\n      this.init();\n      this.setState({\n        reload: !this.state.reload\n      }); //chỉ cần render lại view\n    }\n  }\n\n  static makeQuery(options) {\n    const {\n      filters = [],\n      sorting = [],\n      pageSize,\n      page\n    } = options;\n    let queryObj = {\n      f: [],\n      s: {},\n      ps: pageSize,\n      p: page\n    };\n\n    for (let filter of filters) {\n      queryObj.f.push([filter.field, filter.operator || 'contains', filter.value]);\n    }\n\n    for (let sort of sorting) {\n      queryObj.s[sort.field] = sort.direction;\n    }\n\n    return Base64.encode(JSON.stringify(queryObj));\n  }\n  /**\r\n   * Khai báo các function cho dropdown search box\r\n   */\n\n\n  /**\r\n   * Reload Table\r\n   */\n  async reload() {\n    this.setState({\n      loading: true\n    });\n\n    if (typeof this.props.fetchData === 'function') {\n      const params = this.buildFetchData();\n      const queryOptions = GridTable.makeQuery(params); // console.log(params, queryOptions)\n\n      addQuery({\n        filters: queryOptions\n      });\n      let result = (await this.props.fetchData(params)) || {};\n      if (result.total != undefined) this.total = result.total;\n      this.data = _.get(result, 'data', []);\n    }\n\n    this.setState({\n      loading: false\n    });\n  }\n  /**\r\n   * Set filter từ table vào biến this.columns để controlled\r\n   */\n\n\n  static getDataFromQuery(query = {}, defaultOptions = {}) {\n    let queryObj = query.filters || {};\n\n    if (typeof query.filters == 'string') {\n      try {\n        queryObj = JSON.parse(Base64.decode(query.filters));\n      } catch (e) {\n        throw new Error(`filters params invalid format.`);\n      }\n    }\n\n    if (!queryObj) return {};\n    let filters = queryObj.f || [];\n    let sorting = queryObj.s || {};\n    let queryOut = {\n      filters: defaultOptions.filters || [],\n      sorting: defaultOptions.sorting || [],\n      pageSize: queryObj.ps || defaultOptions.pageSize,\n      page: queryObj.p || defaultOptions.page\n    };\n\n    for (let filter of filters) {\n      queryOut.filters.push({\n        field: filter[0],\n        operator: filter[1],\n        value: filter[2]\n      });\n    }\n\n    for (let field in sorting) {\n      queryOut.sorting.push({\n        field: field,\n        direction: sorting[field]\n      });\n    }\n\n    return queryOut;\n  }\n\n  static getOptions(query, defaultOptions) {\n    if (query && Object.keys(query).length > 0) return this.getDataFromQuery(query, defaultOptions);\n    return defaultOptions;\n  }\n  /**\r\n   * Build data từ this.columns để khớp với format trên server\r\n   */\n\n\n  render() {\n    const _this$props = this.props,\n          {\n      hasData = true,\n      data = [],\n      ellipsis,\n      fetchData,\n      columns,\n      pagination\n    } = _this$props,\n          otherProps = _objectWithoutProperties(_this$props, [\"hasData\", \"data\", \"ellipsis\", \"fetchData\", \"columns\", \"pagination\"]);\n\n    return __jsx(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 13\n      }\n    }, __jsx(Table, _extends({}, this.initialProps, {\n      // tableLayout=\"fixed\"\n      scroll: {\n        x: 900,\n        scrollToFirstRowOnChange: true\n      }\n    }, otherProps, {\n      columns: this.columns,\n      dataSource: hasData ? this.data.map(row => _objectSpread(_objectSpread({}, row), {}, {\n        key: row.id\n      })) : null,\n      onChange: this.handleTableChange,\n      loading: this.state.loading,\n      pagination: this.getPagination(pagination),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 17\n      }\n    })));\n  }\n\n}\n\nexport default GridTable;","map":{"version":3,"sources":["E:/DATN/nursinghome/themes/components/Table/Table.jsx"],"names":["SearchOutlined","Table","Button","Input","Radio","Divider","addQuery","withRouter","useRouter","Highlighter","Base64","_","FilterInput","DatePicker","GridTable","React","Component","constructor","props","defaultOptions","columns","map","column","field","key","sort","sorting","find","item","direction","sortOrder","filters","filter","length","filteredValue","filterable","getColumnSearchProps","ref","createRef","filterDropdown","confirm","setSelectedKeys","confirmFnc","values","currentColumn","c","dataIndex","reload","renderFilter","type","filterIcon","filtered","color","undefined","onFilterDropdownVisibleChange","visible","visibleSearch","current","onSubmit","pageSize","page","pagination","handleTableChange","sorter","columnKey","order","setFiltersToColumns","setSorterToColumns","setPagination","params","push","total","position","showSizeChanger","pageSizeOptions","initialProps","bordered","size","showHeader","hasData","state","loading","data","bind","init","query","router","getDataFromQuery","defaultOptionToColumns","componentDidMount","setState","componentDidUpdate","prevProps","JSON","stringify","makeQuery","options","queryObj","f","s","ps","p","operator","value","encode","fetchData","buildFetchData","queryOptions","result","get","parse","decode","e","Error","queryOut","getOptions","Object","keys","render","ellipsis","otherProps","x","scrollToFirstRowOnChange","row","id","getPagination"],"mappings":"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","sourcesContent":["import { SearchOutlined } from '@ant-design/icons';\r\nimport { Table, Button, Input, Radio, Divider } from 'antd';\r\nimport { addQuery } from 'themes/route'\r\nimport { withRouter, useRouter } from 'next/router'\r\nimport Highlighter from \"react-highlight-words\";\r\nimport { Base64 } from 'js-base64';\r\nimport _ from 'lodash'\r\nimport FilterInput from './SearchComponents/Input'\r\nimport DatePicker from './SearchComponents/DatePicker'\r\n\r\nclass GridTable extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.initialProps = {\r\n            bordered: true,\r\n            size: 'middle',\r\n            showHeader: true,\r\n            hasData: true,\r\n        }\r\n\r\n        this.state = {\r\n            loading: false,\r\n            reload: false\r\n        }\r\n        this.pagination = {}\r\n        this.total = this.props.total || 100\r\n        this.data = this.props.data\r\n        this.handleTableChange = this.handleTableChange.bind(this)\r\n    }\r\n\r\n    /**\r\n     * Khởi tạo các options từ query trên url\r\n     */\r\n    init() {\r\n        const query = this.props.router.query\r\n        const defaultOptions = GridTable.getDataFromQuery(query, this.props)\r\n        this.pagination = {\r\n            pageSize: defaultOptions.pageSize || 50,\r\n            page: defaultOptions.page || 0,\r\n        }\r\n        this.columns = this.props.columns;\r\n\r\n        this.defaultOptionToColumns(defaultOptions);\r\n    }\r\n\r\n    /**\r\n     * Convert lại dữ liệu từ query đổi sang đúng format của column trong antd\r\n     */\r\n    defaultOptionToColumns = (defaultOptions) => {\r\n        this.columns = this.columns.map(column => {\r\n            //set field\r\n            if(!column.field) column.field = column.key\r\n            \r\n            let sort = defaultOptions.sorting.find(item => item.field === column.field);\r\n            if (sort) {\r\n                let { direction } = sort;\r\n                column.sortOrder = direction === \"asc\" ? 'ascend' : 'descend';\r\n            }\r\n            let filters = defaultOptions.filters.filter(item => item.field === column.field);\r\n            if (filters.length) {\r\n                column.filteredValue = [...filters];\r\n            }\r\n            else {\r\n                delete column.filteredValue\r\n            }\r\n            if (column.filterable) {\r\n                //    delete column.filterable;\r\n                column = { ...column, ...this.getColumnSearchProps(column) }\r\n            }\r\n            return column;\r\n        })\r\n    }\r\n    componentDidMount() {\r\n        this.init();\r\n        this.setState({reload: !this.state.reload})\r\n    }\r\n    componentDidUpdate(prevProps) {\r\n        //update data trong trường hợp đổi từ props bên ngoài\r\n        if (JSON.stringify(prevProps.data) !== JSON.stringify(this.props.data)) {\r\n            this.data = this.props.data;\r\n        }\r\n        if (JSON.stringify(this.props.router.query) != JSON.stringify(prevProps.router.query)) {\r\n            this.init();\r\n            this.setState({reload: !this.state.reload}) //chỉ cần render lại view\r\n        }\r\n    }\r\n\r\n    static makeQuery(options) {\r\n        const { filters = [], sorting = [], pageSize, page } = options\r\n        let queryObj = {\r\n            f: [],\r\n            s: {},\r\n            ps: pageSize,\r\n            p: page\r\n        }\r\n\r\n        for (let filter of filters) {\r\n            queryObj.f.push([filter.field, filter.operator || 'contains', filter.value])\r\n        }\r\n        for (let sort of sorting) {\r\n            queryObj.s[sort.field] = sort.direction\r\n        }\r\n        return Base64.encode(JSON.stringify(queryObj))\r\n    }\r\n\r\n    /**\r\n     * Khai báo các function cho dropdown search box\r\n     */\r\n    getColumnSearchProps = column => {\r\n        let ref = React.createRef()\r\n        return {\r\n            filterDropdown: ({ confirm, setSelectedKeys }) => {\r\n                let confirmFnc = (values) => {\r\n                    let currentColumn = this.columns.find(c => c.dataIndex === column.dataIndex)\r\n                    setSelectedKeys(values)\r\n                    confirm()\r\n                    this.reload();\r\n                }\r\n                if (column.renderFilter) {\r\n                    return column.renderFilter({ column, confirm: confirmFnc, ref })\r\n                }\r\n                if(this.props.type == \"date\")\r\n                return <DatePicker\r\n                    column={column}\r\n                    ref={ref}\r\n                    confirm={confirmFnc}\r\n                />\r\n                else\r\n                return <FilterInput\r\n                    column={column}\r\n                    ref={ref}\r\n                    confirm={confirmFnc}\r\n                />\r\n            },\r\n            filterIcon: filtered => (\r\n                <SearchOutlined style={{ color: filtered ? \"#1890ff\" : undefined }} />\r\n            ),\r\n            onFilterDropdownVisibleChange: visible => {\r\n                if (!visible && column.visibleSearch != visible) {\r\n                    column.visibleSearch = visible\r\n                    if (ref.current) {\r\n                        ref.current.onSubmit();\r\n                    }\r\n                }\r\n                column.visibleSearch = visible\r\n                \r\n            }\r\n        };\r\n    }\r\n\r\n    clearAll = async () => {\r\n        let { pageSize, page } = this.pagination\r\n        await this.handleTableChange({ pageSize, current: page }, {}, {})\r\n    }\r\n\r\n    /**\r\n     * Reload Table\r\n     */\r\n    async reload() {\r\n        this.setState({ loading: true })\r\n        if (typeof this.props.fetchData === 'function') {\r\n            const params = this.buildFetchData()\r\n            \r\n            const queryOptions = GridTable.makeQuery(params)\r\n            // console.log(params, queryOptions)\r\n            addQuery({ filters: queryOptions })\r\n            \r\n            let result = await this.props.fetchData(params) || {}\r\n            if (result.total != undefined) this.total = result.total\r\n            this.data = _.get(result, 'data', []);\r\n        }\r\n        this.setState({ loading: false })\r\n    }\r\n\r\n    /**\r\n     * Set filter từ table vào biến this.columns để controlled\r\n     */\r\n    setFiltersToColumns = (filters = {}) => {\r\n        this.columns = this.columns.map(column => {\r\n            let filter = filters[column.field];\r\n            if (filter) {\r\n                column.filteredValue = filter;\r\n            } else {\r\n                delete column.filteredValue;\r\n            }\r\n            return column;\r\n        })\r\n    }\r\n\r\n    setSorterToColumns = (sorter = {}) => {\r\n        this.columns = this.columns.map(column => {\r\n            if (column.key == sorter.columnKey) {\r\n                column.sortOrder = sorter.order;\r\n            } else {\r\n                delete column.sortOrder;\r\n            }\r\n            return column;\r\n        })\r\n    }\r\n    setPagination = (pagination) => {\r\n        this.pagination = {\r\n            pageSize: pagination.pageSize,\r\n            page: pagination.current - 1\r\n        }\r\n    }\r\n\r\n\r\n    handleTableChange = async (pagination, filters, sorter) => {\r\n        this.setFiltersToColumns(filters);\r\n        this.setSorterToColumns(sorter);\r\n        this.setPagination(pagination);\r\n        this.reload();\r\n    }\r\n\r\n    static getDataFromQuery(query = {}, defaultOptions = {}) {\r\n        let queryObj = query.filters || {}\r\n        if (typeof query.filters == 'string') {\r\n            try {\r\n                queryObj = JSON.parse(Base64.decode(query.filters))\r\n            }\r\n            catch (e) {\r\n                throw new Error(`filters params invalid format.`)\r\n            }\r\n        }\r\n        if (!queryObj) return {}\r\n        let filters = queryObj.f || []\r\n        let sorting = queryObj.s || {}\r\n        let queryOut = {\r\n            filters: defaultOptions.filters || [],\r\n            sorting: defaultOptions.sorting || [],\r\n            pageSize: queryObj.ps || defaultOptions.pageSize,\r\n            page: queryObj.p || defaultOptions.page\r\n        } \r\n\r\n        for (let filter of filters) {\r\n            queryOut.filters.push({\r\n                field: filter[0],\r\n                operator: filter[1],\r\n                value: filter[2]\r\n            })\r\n        }\r\n        for (let field in sorting) {\r\n            queryOut.sorting.push({\r\n                field: field,\r\n                direction: sorting[field]\r\n            })\r\n        }\r\n\r\n        return queryOut;\r\n    }\r\n\r\n    static getOptions(query, defaultOptions) {\r\n        if (query && Object.keys(query).length > 0) return this.getDataFromQuery(query, defaultOptions)\r\n        return defaultOptions\r\n    }\r\n\r\n    /**\r\n     * Build data từ this.columns để khớp với format trên server\r\n     */\r\n    buildFetchData = () => {\r\n        let params = {\r\n            filters: [],\r\n            sorting: [],\r\n            pageSize: this.pagination.pageSize,\r\n            page: this.pagination.page\r\n        }\r\n\r\n        this.columns.map(column => {\r\n            if (column.filteredValue) {\r\n                params.filters = [\r\n                    ...params.filters,\r\n                    ...column.filteredValue\r\n                ]\r\n            }\r\n            if (column.sortOrder) {\r\n                params.sorting.push({\r\n                    field: column.field,\r\n                    direction: column.sortOrder == \"ascend\" ? \"asc\" : \"desc\",\r\n                })\r\n            }\r\n        })\r\n        return params\r\n\r\n    }\r\n\r\n    getPagination = (pagination = {}) => {\r\n        const { pageSize, page } = this.pagination;\r\n        return {\r\n            ...pagination,\r\n            total: this.total,\r\n            position: 'bottom',\r\n            pageSize: pageSize || 50,\r\n            current: page + 1,\r\n            showSizeChanger: true,\r\n            pageSizeOptions: ['2', '10', '50', '100', '200', '500']\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const { hasData = true, data = [], ellipsis, fetchData, columns, pagination, ...otherProps } = this.props;\r\n        return (\r\n            <div>\r\n                <Table\r\n                    {...this.initialProps}\r\n                    // tableLayout=\"fixed\"\r\n                    scroll={{\r\n                        x: 900,\r\n                        scrollToFirstRowOnChange: true\r\n                    }}\r\n                    {...otherProps}\r\n                    columns={this.columns}\r\n                    dataSource={hasData ? this.data.map(row => ({ ...row, key: row.id })) : null}\r\n                    onChange={this.handleTableChange}\r\n                    loading={this.state.loading}\r\n                    pagination={this.getPagination(pagination)}\r\n                />\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default GridTable"]},"metadata":{},"sourceType":"module"}